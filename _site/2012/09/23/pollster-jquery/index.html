<!DOCTYPE HTML>

<html>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
    <meta name='author' content='John Shanley' />
    <link rel='stylesheet' type='text/css' href='/stylesheets/base.css'>
    <title>Pollster Jquery</title>
  </head>
  <body>
    <header id='page-header'>
      
    </header>
    <div role='main'>
      <h1>Pollster API: JSONP requests with jQuery</h1>

<p>The <a href="http://elections.huffingtonpost.com/pollster/api">Pollster API</a> now supports JSONP to allow for cross-origin HTTP requests.</p>

<p>jQuery has built-in support for making AJAX calls using <code>$.ajax()</code> and for returning data as JSONP, but in this case, the API requires named callbacks, and does not permit the additional parameters that are generated by the default settings for <code>$.ajax()</code>.</p>

<p>To get a response from the API:</p>

<ul>
<li><p>the callback must be named either <code>pollsterChart</code> or <code>pollsterPoll</code></p></li>
<li><p>the timestamp parameter must be removed.</p></li>
</ul>


<p>To meet these requirements, you can make your <code>$.ajax()</code> call in the following way:</p>

<p><pre><code>$.ajax({
    url: 'http://elections.huffingtonpost.com/pollster/api/polls.json?callback=pollsterPoll',
    dataType: 'script',
    type: 'GET',
    cache: true
});</code></pre></p>


<p>This does two essential things:</p>

<ul>
<li><p>it specifies the name of the callback function by appending <code>?callback=pollsterPoll</code> to the end of the url.</p></li>
<li><p>it removes the timestamp parameter by setting <code>cache: true</code> which tells the browser to cache the response.</p></li>
</ul>


<p>Finally, in order to use the data from the response, you must define a function to be run when the callback is called:</p>

<p><pre><code>window.pollsterPoll = function(incoming_data){
    console.log(incoming_data);
};</code></pre></p>


<h2>Example</h2>

<p>Here's a simple example of what this might look like in practice:</p>

<p><pre><code>var API_SERVER = 'http://elections.huffingtonpost.com',
    API_BASE = '/pollster/api',
    API_FILE = 'polls.json',
    callback = '?callback=pollsterPoll',
    params = '&state=NY&topic=2012-president',
    latest_data;

window.pollsterPoll = function(incoming_data){
    latest_data = incoming_data;
    visualize();
};

$document.ready(function(){
    $.ajax({
        url: API_SERVER + API_BASE + API_FILE + callback + params,
        dataType: 'script',
        type: 'GET',
        cache: true
    });
});

function visualize(){
    /* do something with the latest_data object */
}
</code></pre></p>




    </div>
    <footer id='page-footer'>
      <p>&copy; John Shanley, 2012</p>
    </footer>
  </body>
</html>
